# База тест-кейсов для эндпоинта `/endpoint`

> **Требования из ТЗ**:
> - Все ответы — HTTP **200**
> - Успешный результат: `{"result": "OK"}`
> - Ошибка: `{"result": "ERROR", "message": "reason"}`
> - Действия: `LOGIN`, `ACTION`, `LOGOUT`
> - Токен: 32 символа, только `0-9A-F`
> - Обязательный заголовок: `X-Api-Key: qazWSXedc`

---

## ✅ Позитивные сценарии

### TC-01: Успешная аутентификация (LOGIN)
- **Предусловие**: Внешний сервис `/auth` возвращает HTTP 200
- **Шаги**:
    1. Отправить POST-запрос на `/endpoint`
        - `token=A1B2C3D4E5F678901234567890ABCDEF`
        - `action=LOGIN`
        - Заголовок: `X-Api-Key: qazWSXedc`
- **Ожидаемый результат**:
    - HTTP 200
    - Тело: `{"result": "OK"}`

### TC-02: Успешное выполнение ACTION после LOGIN
- **Предусловие**: Токен прошёл аутентификацию
- **Шаги**:
    1. Выполнить LOGIN (см. TC-01)
    2. Отправить запрос с `action=ACTION`
- **Ожидаемый результат**:
    - HTTP 200
    - Тело: `{"result": "OK"}`

### TC-03: Успешный LOGOUT
- **Предусловие**: Токен аутентифицирован
- **Шаги**:
    1. Выполнить LOGIN
    2. Отправить запрос с `action=LOGOUT`
- **Ожидаемый результат**:
    - HTTP 200
    - Тело: `{"result": "OK"}`

---

## ❌ Негативные сценарии

### TC-04: ACTION без предварительного LOGIN
- **Шаги**:
    1. Отправить запрос с `action=ACTION` (без LOGIN)
- **Ожидаемый результат**:
    - HTTP 200
    - Тело: `{"result": "ERROR", "message": "..."}` (без упоминания валидации токена)

### TC-05: Повторный LOGIN тем же токеном
- **Предусловие**: Токен уже прошёл аутентификацию
- **Шаги**:
    1. Выполнить LOGIN
    2. Повторно отправить `action=LOGIN` с тем же токеном
- **Ожидаемый результат**:
    - HTTP 200
    - Тело: `{"result": "ERROR", "message": "..."}`

### TC-06: Ошибка внешнего сервиса при LOGIN (`/auth` → 500)
- **Шаги**:
    1. Настроить мок `/auth`, возвращающий HTTP 500 с телом `{}`
    2. Отправить `action=LOGIN`
- **Ожидаемый результат**:
    - HTTP 200
    - Тело: `{"result": "ERROR", "message": "..."}`

### TC-07: Запрос без заголовка `X-Api-Key`
- **Шаги**:
    1. Отправить запрос без заголовка `X-Api-Key`
- **Ожидаемый результат**:
    - HTTP 200
    - Тело: `{"result": "ERROR", "message": "API key is required"}`

### TC-08: Невалидный формат токена
- **Шаги**:
    1. Отправить запрос с токеном, не соответствующим регулярке `^[0-9A-F]{32}$`  
       (например, `token=INVALID`)
- **Ожидаемый результат**:
    - HTTP 200
    - Тело: `{"result": "ERROR", "message": "token: должно соответствовать \"^[0-9A-F]{32}$\""}`

---

## ⚠️ Известные баги (на основе логов)

| ID | Описание | Фактическое поведение | Статус |
|----|--------|----------------------|--------|
| BUG-01 | При ошибке `/auth` → 500 приложение возвращает HTTP 500 вместо 200 + JSON | HTTP 500 | Открыт |
| BUG-02 | Повторный LOGIN возвращает HTTP 409 вместо 200 + JSON | HTTP 409 | Открыт |
| BUG-03 | Отсутствие `X-Api-Key` возвращает HTTP 401 вместо 200 + JSON | HTTP 401 | Открыт |

> 💡 **Вывод**: Приложение нарушает контракт API из ТЗ. Все ошибки должны возвращаться через JSON при HTTP 200.